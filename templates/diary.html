<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&family=Caveat&family=Shadows+Into+Light&family=Parisienne&family=Nothing+You+Could+Do&family=Handlee&family=Patrick+Hand&family=Reenie+Beanie&family=Indie+Flower&family=Gloria+Hallelujah&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='book.css') }}">
    <title>Heirloom Diary</title>
</head>

<body>

<div class="book">

    <!-- LEFT PAGE (History Browser) -->
    <div class="page page-left">

        <div class="date-title">
            {{ formatted_date }}
        </div>

        <div class="entry">

            {% for entry in entries %}
                <div class="entry-block" id="entry-{{ entry.id }}">

                    <p class="hw-{{ entry.user.handwriting_style }} ink {% if entry.scratched %}scratched{% endif %}">
                        {{ entry.content | replace('\n', '<br>') | safe }}
                    </p>

                    <small class="signature hw-{{ entry.user.handwriting_style }} ink">
                        â€” {{ entry.user.username }}
                    </small>

                    {% if not entry.scratched %}
                        <a href="#"
                        class="scratch-btn"
                        data-id="{{ entry.id }}">
                            Scratch
                        </a>
                    {% endif %}

                </div>
            {% endfor %}

        </div>

        <!-- Page Flip Navigation -->
        <div class="page-nav">

            {% if previous_date %}
                <a href="{{ url_for('diary', date=previous_date) }}" class="page-btn animate-page">
                    Previous Page
                </a>
            {% endif %}

            {% if next_date %}
                <a href="{{ url_for('diary', date=next_date) }}" class="page-btn animate-page">
                    Next Page
                </a>
            {% endif %}

        </div>

    </div>

    <!-- RIGHT PAGE (Writing For Selected Date) -->
    <div class="page page-right">

        <div class="today-header">

            <div class="date-row">

                <form method="GET" action="{{ url_for('diary') }}" class="calendar-form">

                    <input type="date"
                        name="date"
                        class="calendar-input"
                        min="2026-01-01"
                        max="2026-12-31"
                        value="{{ selected_date }}"
                        onchange="this.form.submit()">

                </form>

            </div>

        </div>

        <form method="POST" class="entry-form" novalidate>

            <textarea 
                name="content"
                class="hw-{{ current_user.handwriting_style }} ink"
                placeholder="Thoughts for the day..."></textarea>

            <button type="submit">Commit to the Archive</button>
        </form>

        <div class="right-footer">
            <a href="/logout" class="close-link">Close Book</a>
        </div>

    </div>

</div>

<script>
document.querySelectorAll('.animate-page').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelector('.page-left').style.animation = 'pageEnterLeft 0.8s ease';
        document.querySelector('.page-right').style.animation = 'pageEnterRight 0.8s ease';
    });
});
</script>

<script>
document.addEventListener("DOMContentLoaded", function() {

    const entryContainer = document.querySelector(".entry");
    if (!entryContainer) return;

    if (window.location.hash) {

        const target = document.querySelector(window.location.hash);

        if (target) {
            target.scrollIntoView({
                behavior: "smooth",
                block: "center"
            });
        }

        history.replaceState(null, null, window.location.pathname + window.location.search);

    } else {

        entryContainer.scrollTo({
            top: entryContainer.scrollHeight,
            behavior: "smooth"
        });

    }

});
</script>

<script>
document.querySelectorAll('.scratch-btn').forEach(btn => {

    btn.addEventListener('click', function(e) {

        e.preventDefault();

        const entryId = this.dataset.id;

        fetch(`/scratch/${entryId}`)
            .then(() => {

                const entryBlock = this.closest('.entry-block');
                const text = entryBlock.querySelector('p');

                text.classList.add('scratched');

                this.remove();

            });

    });

});
</script>

</body>
</html>
